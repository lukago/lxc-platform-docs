@Override
public void configureClientInboundChannel(ChannelRegistration registration) {
  registration.interceptors(new ChannelInterceptor() {
    @Override
    public Message<?> preSend(Message<?> message, MessageChannel channel) {
      StompHeaderAccessor accessor = MessageHeaderAccessor
          .getAccessor(message, StompHeaderAccessor.class);
      if (accessor != null && StompCommand.CONNECT.equals(accessor.getCommand())) {
        String token = jwtTokenProvider
            .resolveToken(accessor)
            .orElseThrow(() -> new HttpException("No token provided for socket", HttpStatus.UNAUTHORIZED));
        if (jwtTokenProvider.validateToken(token)) {
          Authentication auth = jwtTokenProvider.getAuthentication(token);
          accessor.setUser(auth);
        }
      }
      return message;
    }
  });
}